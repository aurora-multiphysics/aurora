<!DOCTYPE html><head><meta charset="UTF-8"><title>MultiApp System | Aurora App</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a class="left moose-logo hide-on-med-and-down">Aurora App</a><a href="https://github.com/aurora-multiphysics/aurora" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"></ul><a href="#" class="sidenav-trigger" data-target="dfa71182-5a14-4b1f-8d86-1123095a0798"><i class="material-icons">menu</i></a><ul class="sidenav" id="dfa71182-5a14-4b1f-8d86-1123095a0798"></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">syntax</a><a href="." class="breadcrumb">MultiApps</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="165c06b4-e989-4fc8-b905-d9eeb17b1318" data-section-level="1" data-section-text="MultiApp System"><h1 id="multiapp-system">MultiApp System</h1><section class="scrollspy" id="71367ec7-8f7c-4564-a1d5-c625b7506f5a" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>MOOSE was originally created to solve fully-coupled systems of , but not all systems need to be or are fully coupled:</p><ul class="browser-default"><li><p>multiscale systems are generally loosely coupled between scales; </p></li><li><p>systems with both fast and slow physics can be decoupled in time; and </p></li><li><p>simulations involving input from external codes might be solved somewhat decoupled.</p></li></ul><p>To MOOSE these situations look like loosely-coupled systems of fully-coupled equations. A <code>MultiApp</code> allows you to simultaneously solve for individual physics systems.</p><p>Each sub-application (app) is considered independent. There is always a &quot;main&quot; app that is doing the primary solve. The &quot;main&quot; app can then have any number of <code>MultiApp</code> objects. Each <code>MultiApp</code> can represent many (hence Multi) &quot;sub-applications&quot; (sub-apps). The sub-apps can be solving for completely different physics from the main application.  They can be other MOOSE applications, or might represent external applications. A sub-app can, itself, have <code>MultiApps</code>, leading to multi-level solves, as shown below.</p><div class="card moose-float" style="width:60%;margin-left:auto;margin-right:auto;" id="multiapps"><div class="card-content"><picture class="materialboxed moose-image"><img src="../../large_media/multi_apps/multiapp_hierarchy.png"></img></picture><p class="moose-caption"><span class="moose-caption-heading">Figure 1: </span><span class="moose-caption-text">Example multi-level MultiApp hierarchy.</span></p></div></div></section><section class="scrollspy" id="52ab88ba-3225-40d1-bac6-85e8ca63dfea" data-section-level="2" data-section-text="Input File Syntax"><h2 id="input-file-syntax">Input File Syntax</h2><p><code>MultiApp</code> objects are declared in the <code>[MultiApps]</code> block and require a &quot;type&quot; just like may other blocks.</p><p>The <a href="#ceeef849-e59d-4996-9749-39d27cf93c46" class="moose-modal-link modal-trigger">&quot;app_type&quot;</a> is the name of the <code>MooseApp</code> derived app that is going to be executed. Generally, this is the name of the application being executed, therefore if this parameter is omitted it will default as such. However this system is designed for running another applications that are compiled or linked into the current app.</p><p>Sub-apps are created when a MultiApp is added by MOOSE.</p><p>A <code>MultiApp</code> can be executed at any point during the main solve by setting the <a href="#17c35da3-639d-4aef-b9da-085b4a9a0c5a" class="moose-modal-link modal-trigger">&quot;execute_on&quot;</a> parameter. MultiApps at the same point are executed sequentially. Before the execution, data on the main app are transferred to sub-apps of all the MultiApps and data on sub-apps are transferred back after the execution. The execution order of all MultiApps at the same point is not determined. The order is also irrelevant because no data transfers directly among MultiApps. To enforce the ordering of execution, users can use multi-level MultiApps or set the MultiApps executed at different points. If a <code>MultiApp</code> is set to be executed on timestep_begin or timestep_end, the formed loosely-coupled systems of fully-coupled equations can be solved with <a href="../Executioner/index.html">Picard iterations</a>.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[MultiApps]
  [sub_app]
    type = TransientMultiApp
    app_type = MooseTestApp
    input_files = &#x27;dt_from_master_sub.i&#x27;
    positions = &#x27;0   0   0
                 0.5 0.5 0
                 0.6 0.6 0
                 0.7 0.7 0&#x27;
  []
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#ab8197b6-d0ea-41f8-a500-5ea44c248402">(../../../SoftwareDownloads/moose/test/tests/multiapps/transient_multiapp/dt_from_master.i)</a></section><section class="scrollspy" id="1e783ef4-c6f0-46ce-b512-5954adc6e068" data-section-level="2" data-section-text="Positions"><h2 id="multiapp-positions">Positions</h2><p>The <a href="#38842d4a-b157-496b-8e8e-1f9e59994822" class="moose-modal-link modal-trigger">&quot;positions&quot;</a> parameter is a coordinate offset from the main app domain to the sub-app domain, as illustrated by <a href="#multiapps_pos">Figure 2</a>. The parameter requires the positions to be provided as a set of <span class="moose-katex-inline-equation" id="moose-equation-c8b7435c-322d-470e-b15f-bd3a6f4305a1"><script>var element = document.getElementById("moose-equation-c8b7435c-322d-470e-b15f-bd3a6f4305a1");katex.render("(x, y, z)", element, {displayMode:false,throwOnError:false});</script></span> coordinates for each sub-app.</p><p>The number of coordinate sets determines the actual number of sub-applications created.  If there is a large number of positions a file can be provided instead using the <a href="#3d2089da-9135-4c6e-94bc-564ea2d2a4d3" class="moose-modal-link modal-trigger">&quot;positions_file&quot;</a> parameter.</p><ul class="browser-default"><li><p>The <span class="moose-katex-inline-equation" id="moose-equation-b7b96aa8-3abe-4ab4-af8e-82156a8dee94"><script>var element = document.getElementById("moose-equation-b7b96aa8-3abe-4ab4-af8e-82156a8dee94");katex.render("(x, y, z)", element, {displayMode:false,throwOnError:false});</script></span> coordinates are a vector that is being added to the coordinates of the sub-app&#x27;s domain to put that domain in a specific location within the main domain. </p></li><li><p>If the sub-app&#x27;s domain starts at <span class="moose-katex-inline-equation" id="moose-equation-5757fa5c-0cfe-49bd-a224-7315c9b4aaa5"><script>var element = document.getElementById("moose-equation-5757fa5c-0cfe-49bd-a224-7315c9b4aaa5");katex.render("(0,0,0)", element, {displayMode:false,throwOnError:false});</script></span> it is easy to think of moving that point around using <a href="#b8cb445e-d51d-4618-92f7-e1e73193b3af" class="moose-modal-link modal-trigger">&quot;positions&quot;</a>. </p></li><li><p>For sub-apps on completely different scales, <code>positions</code> is the point in the main domain where that app is located.</p></li></ul><div class="card moose-float" style="width:80%;margin-left:auto;margin-right:auto;" id="multiapps_pos"><div class="card-content"><picture class="materialboxed moose-image"><img src="../../large_media/framework/multiapps_positions.png"></img></picture><p class="moose-caption"><span class="moose-caption-heading">Figure 2: </span><span class="moose-caption-text">Example of MultiApp object position.</span></p></div></div><p>If this parameter is not provided, a single position (0,0,0) will be used.</p></section><section class="scrollspy" id="a5cde46e-0a9f-47c1-8dbb-886f231a90a9" data-section-level="2" data-section-text="Parallel Execution"><h2 id="parallel-execution">Parallel Execution</h2><p>The <code>MultiApp</code> system is designed for efficient parallel execution of hierarchical problems. The main application utilizes all processors.  Within each <code>MultiApp</code>, all of the processors are split among the sub-apps. If there are more sub-apps than processors, each processor will solve for multiple sub-apps.  All sub-apps of a given <code>MultiApp</code> are run simultaneously in parallel. Multiple <code>MultiApps</code> will be executed one after another.</p></section><section class="scrollspy" id="371ca2b8-805c-4015-b6f0-f65a48cbe11e" data-section-level="2" data-section-text="Dynamically Loading Multiapps"><h2 id="dynamically-loading-multiapps">Dynamically Loading Multiapps</h2><p>If building with dynamic libraries (the default) other applications can be loaded without adding them to your Makefile and registering them. Simply set the proper <code>type</code> in your input file (e.g. <code>AnimalApp</code>) and MOOSE will attempt to find the other library dynamically.</p><ul class="browser-default"><li><p>The path (relative preferred) can be set in your input file using the parameter <a href="#328bc0d9-545f-41cf-8eba-11a3da54efd0" class="moose-modal-link modal-trigger">&quot;library_path&quot;</a>; this path needs to point to the <code>lib</code> folder within an application directory. </p></li><li><p>The <code>MOOSE_LIBRARY_PATH</code> may also be set to include paths for MOOSE to search.</p></li></ul><div class="card moose-alert moose-alert-warning"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">warning</i><span class="moose-alert-title-brand">warning</span></div><div class="card-content"><div class="moose-alert-content"><p><p>Each application must be compiled separately since the main application Makefile does not have knowledge of any sub-app application dependencies.</p></p></div></div></div></section><section class="scrollspy" id="6cb1efef-7416-468d-8d3a-f23f007057fe" data-section-level="2" data-section-text="Restart and Recover"><h2 id="restart-and-recover">Restart and Recover</h2><p>General information about restart/recover can be found at Restart/Recovery. When running a multiapp simulation you do not need to enable checkpoint output in each sub-app input file. The main app stores the restart data for all sub-apps in its file. When restarting or recovering, the main app restores the restart data of all sub-apps into MultiApp&#x27;s <em>backups</em> (a data structure holding all the current state including solution vectors, stateful material properties, post-processors, restartable quantties declared in objects and etc. of the sub-apps), which are used by sub-apps to restart/recover the calculations in their initial setups. The same backups are also used by multiapps for saving/restoring the current state during Picard iterations.</p><p>A sub-app may choose to use a restart file instead of the main backup file by setting <a href="#570a10d9-c5b0-4db6-b1bf-823e62586d80" class="moose-modal-link modal-trigger">&quot;force_restart&quot;</a> to true.</p><div class="card moose-alert moose-alert-warning"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">warning</i><span class="moose-alert-title-brand">warning</span></div><div class="card-content"><div class="moose-alert-content"><p><p><a href="#a9e3a1e9-4456-435d-8468-04788a768067" class="moose-modal-link modal-trigger">&quot;force_restart&quot;</a> is experimental.</p></p></div></div></div></section><section class="scrollspy" id="1aaabeb3-722f-479d-a989-675a4023b1f4" data-section-level="2" data-section-text="Available Objects"><h2 id="available-objects">Available Objects</h2><ul class="moose-syntax-list collection with-header"><li class="collection-header">Moose App</li><li class="collection-item"><a href="../../source/multiapps/CentroidMultiApp.html">CentroidMultiApp</a>Automatically generates Sub-App positions from centroids of elements in the master mesh.</li><li class="collection-item"><a href="../../source/multiapps/FullSolveMultiApp.html">FullSolveMultiApp</a>Performs a complete simulation during each execution.</li><li class="collection-item"><a href="../../source/multiapps/TransientMultiApp.html">TransientMultiApp</a>MultiApp for performing coupled simulations with the master and sub-application both progressing in time.</li></ul></section><section class="scrollspy" id="8a24a1ed-b487-4eb8-8357-7cb2b06eab13" data-section-level="2" data-section-text="Available Actions"><h2 id="available-actions">Available Actions</h2><ul class="moose-syntax-list collection with-header"><li class="collection-header">Moose App</li><li class="collection-item"><a href="../../source/actions/AddMultiAppAction.html">AddMultiAppAction</a>Add a MultiApp object to the simulation.</li></ul></section></section><div class="moose-modal modal" id="ceeef849-e59d-4996-9749-39d27cf93c46"><div class="modal-content"><h4>app_type</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MooseEnum</p><p class="moose-parameter-description-options"><span>Options:</span>AuroraApp, AuroraTestApp</p><p class="moose-parameter-description"><span>Description:</span>The type of application to build (applications not registered can be loaded with dynamic libraries. Master application type will be used if not provided.</p></div></div><div class="moose-modal modal" id="17c35da3-639d-4aef-b9da-085b4a9a0c5a"><div class="modal-content"><h4>execute_on</h4><p class="moose-parameter-description-default"><span>Default:</span>TIMESTEP_BEGIN</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>ExecFlagEnum</p><p class="moose-parameter-description-options"><span>Options:</span>NONE, INITIAL, LINEAR, NONLINEAR, TIMESTEP_END, TIMESTEP_BEGIN, FINAL, CUSTOM</p><p class="moose-parameter-description"><span>Description:</span>The list of flag(s) indicating when this object should be executed, the available options include NONE, INITIAL, LINEAR, NONLINEAR, TIMESTEP_END, TIMESTEP_BEGIN, FINAL, CUSTOM.</p></div></div><div class="moose-modal modal" id="ab8197b6-d0ea-41f8-a500-5ea44c248402"><div class="modal-content"><h4>(../../../SoftwareDownloads/moose/test/tests/multiapps/transient_multiapp/dt_from_master.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 10
  ny = 10
[]

[Variables]
  [./u]
  [../]
[]

[Kernels]
  [./diff]
    type = Diffusion
    variable = u
  [../]
  [./td]
    type = TimeDerivative
    variable = u
  [../]
[]

[BCs]
  [./left]
    type = DirichletBC
    variable = u
    boundary = left
    value = 0
  [../]
  [./right]
    type = DirichletBC
    variable = u
    boundary = right
    value = 1
  [../]
[]

[Executioner]
  type = Transient
  num_steps = 10
  dt = 0.2

  solve_type = &#x27;PJFNK&#x27;

  petsc_options_iname = &#x27;-pc_type -pc_hypre_type&#x27;
  petsc_options_value = &#x27;hypre boomeramg&#x27;
[]

[Outputs]
  exodus = true
[]

[MultiApps]
  [sub_app]
    type = TransientMultiApp
    app_type = MooseTestApp
    input_files = &#x27;dt_from_master_sub.i&#x27;
    positions = &#x27;0   0   0
                 0.5 0.5 0
                 0.6 0.6 0
                 0.7 0.7 0&#x27;
  []
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="38842d4a-b157-496b-8e8e-1f9e59994822"><div class="modal-content"><h4>positions</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;libMesh::Point&gt;</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>The positions of the App locations.  Each set of 3 values will represent a Point.  This and 'positions_file' cannot be both supplied. If this and 'positions_file' are not supplied, a single position (0,0,0) will be used</p></div></div><div class="moose-modal modal" id="3d2089da-9135-4c6e-94bc-564ea2d2a4d3"><div class="modal-content"><h4>positions_file</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;FileName&gt;</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>A filename that should be looked in for positions. Each set of 3 values in that file will represent a Point.  This and 'positions' cannot be both supplied</p></div></div><div class="moose-modal modal" id="b8cb445e-d51d-4618-92f7-e1e73193b3af"><div class="modal-content"><h4>positions</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;libMesh::Point&gt;</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>The positions of the App locations.  Each set of 3 values will represent a Point.  This and 'positions_file' cannot be both supplied. If this and 'positions_file' are not supplied, a single position (0,0,0) will be used</p></div></div><div class="moose-modal modal" id="328bc0d9-545f-41cf-8eba-11a3da54efd0"><div class="modal-content"><h4>library_path</h4><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::string</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>Path to search for dynamic libraries (please avoid committing absolute paths in addition to MOOSE_LIBRARY_PATH)</p></div></div><div class="moose-modal modal" id="570a10d9-c5b0-4db6-b1bf-823e62586d80"><div class="modal-content"><h4>force_restart</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>EXPERIMENTAL: If true, a sub_app may use a restart file instead of using of using the master backup file</p></div></div><div class="moose-modal modal" id="a9e3a1e9-4456-435d-8468-04788a768067"><div class="modal-content"><h4>force_restart</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-options"><span>Options:</span></p><p class="moose-parameter-description"><span>Description:</span>EXPERIMENTAL: If true, a sub_app may use a restart file instead of using of using the master backup file</p></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#71367ec7-8f7c-4564-a1d5-c625b7506f5a" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#52ab88ba-3225-40d1-bac6-85e8ca63dfea" class="tooltipped" data-position="left" data-tooltip="Input File Syntax">Input File Syntax</a></li><li><a href="#1e783ef4-c6f0-46ce-b512-5954adc6e068" class="tooltipped" data-position="left" data-tooltip="Positions">Positions</a></li><li><a href="#a5cde46e-0a9f-47c1-8dbb-886f231a90a9" class="tooltipped" data-position="left" data-tooltip="Parallel Execution">Parallel Execution</a></li><li><a href="#371ca2b8-805c-4015-b6f0-f65a48cbe11e" class="tooltipped" data-position="left" data-tooltip="Dynamically Loading Multiapps">Dynamically Loading Multiapps</a></li><li><a href="#6cb1efef-7416-468d-8d3a-f23f007057fe" class="tooltipped" data-position="left" data-tooltip="Restart and Recover">Restart and Recover</a></li><li><a href="#1aaabeb3-722f-479d-a989-675a4023b1f4" class="tooltipped" data-position="left" data-tooltip="Available Objects">Available Objects</a></li><li><a href="#8a24a1ed-b487-4eb8-8357-7cb2b06eab13" class="tooltipped" data-position="left" data-tooltip="Available Actions">Available Actions</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script>